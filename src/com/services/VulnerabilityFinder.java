package com.services;

import java.io.IOException;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.Scanner;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class VulnerabilityFinder {

	Scanner scan;
	HttpURLConnection connection;
	public URL url;

	@Autowired
	ConnectionService connectionService;

	public boolean isExploitInReadme(String RepoName, String defaultBranch) {

		boolean flag = false;

		try {
			url = connectionService.getConnection(RepoName,defaultBranch);

			if (url != null) {
				Pattern pattern = Pattern.compile("(exploit|vulnerability)", Pattern.CASE_INSENSITIVE);
				scan = new Scanner(url.openStream());
				while (scan.hasNext()) {
					Matcher matcher = pattern.matcher(scan.nextLine());

					if (matcher.find()) {
						System.out.println("\n----------------------");
						System.out.println("found match in Repo : " + RepoName);
						System.out.println("------------------------\n");

						flag = true;
						break;
					}
				}
			}
		} catch (IOException e) {
			e.printStackTrace();
		} finally {
			if (scan != null)
				scan.close();
		}

		return flag;
	}

}
