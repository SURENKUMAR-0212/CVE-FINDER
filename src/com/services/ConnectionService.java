//$Id$
package com.services;

import java.io.IOException;
import java.net.HttpURLConnection;
import java.net.URL;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.mvc.model.API;

@Service
public class ConnectionService {

	private final int HTTP_STATUS_OK = 200;

	private URL url;
	private HttpURLConnection connection;

	@Autowired
	private API api;


	// apt name for user to get connection URL
	public URL getConnection(String RepoName, String defaultBranch) throws IOException {
		return getValidURL(RepoName,defaultBranch);
	}

	
	private URL getValidURL(String RepoName,String defaultBranch) throws IOException {
			getParsedURL(RepoName, defaultBranch);
			
			if(isReadMepresent(connection))
			{
				System.out.println("I found readMe in : "+url);
				return url;
			}
		return null;
	}
	
	// Parse the URL with repository name
	private void getParsedURL(String RepoName,String defaultBranch) throws IOException {
		url = new URL(api.getREAD_ME_FILE()
				.replace("${full_name}", RepoName)
				.replace("${branch}", defaultBranch));
		connection = (HttpURLConnection) url.openConnection();
		connection.setRequestMethod("GET");			
	}

	
	// Is READme is present current URL
	private boolean isReadMepresent(HttpURLConnection connection) throws IOException {
		return connection.getResponseCode() == HTTP_STATUS_OK;
	}

}